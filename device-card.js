import{u as Ne,a as Ie,d as l,A as H,q as x,_ as Te,y as P,b as e,c as J,k as K}from"./vendor.js";import{s as Q,u as qe,a as y,b as q,c as m,p as ke,A as r,L as xe,S as ye,B as X,w as Y,d as Z,g as Ce,e as we}from"./index.js";const Se="_devices_1qeq9_2",Ae="_wrapperBtn_1qeq9_10",De="_content_1qeq9_29",Ge="_loadingText_1qeq9_39",Le="_settingsAndGroupWrapper_1qeq9_59",We="_buttonTabs_1qeq9_59",Be="_buttonTabItemSettings_1qeq9_62",Fe="_buttonTabItemGroup_1qeq9_63",Re="_buttonTabItemActiveSettings_1qeq9_78",Me="_buttonTabItemActiveGroup_1qeq9_79",Pe="_contentBody_1qeq9_93",$e="_element_1qeq9_108",Oe="_valueWrapper_1qeq9_115",Ue="_valueName_1qeq9_128",Ve="_value_1qeq9_115",je="_backdrop_1qeq9_150",ze="_line_1qeq9_160",Ee="_groupFlex_1qeq9_185",He="_groupItem_1qeq9_197",s={devices:Se,wrapperBtn:Ae,content:De,loadingText:Ge,settingsAndGroupWrapper:Le,buttonTabs:We,buttonTabItemSettings:Be,buttonTabItemGroup:Fe,buttonTabItemActiveSettings:Re,buttonTabItemActiveGroup:Me,contentBody:Pe,element:$e,valueWrapper:Oe,valueName:Ue,value:Ve,backdrop:je,line:ze,groupFlex:Ee,groupItem:He},c=[0,.7,1,1.4,2,2.8,4,5.7,8,11.3,16,22.6,32,45.3,64,90.5],o=[358,253,179,127,89.4,63.3,44.7,31.6,22.4,15.8,11.2,7.9,5.6,4,2.8],Je=i=>o[i-1]??o[0],Ke=i=>c[i]??c[0],Qe=i=>{const u=o.findIndex(d=>d===i);return u===-1?1:u+1},Xe=i=>c.findIndex(u=>u===i);function ct(){const{params:i}=Ne(),{route:u}=Ie(),[d,C]=l(1),[g,$]=l(!1),[p,w]=l(1),[f,S]=l(1),[b,A]=l(1),[_,D]=l(2.8),[N,G]=l(0),[ee,te]=l(0),[Ye,se]=l(0),[L,O]=l(Array(16).fill(!1)),[Ze,ne]=l(null),W=H(null),B=H(null),F=Q.value.isLoadingUI||Q.value.isLoadingIntervalStatus,[ie,et]=l(!1),[I,U]=l("settings"),{isMobile340:a,isMobile400:V}=qe(),[tt,j]=l(!1),[R,z]=l(!1),[v,ae]=l(void 0),[st,nt]=l({generalRange:0,r:0,g:0,b:0,w:0,light:0});x(()=>{g?(q({driver:"test",cmd:"stop"},!1),$(!g)):($(!g),q({driver:"test",cmd:"start",addres:+(i==null?void 0:i.id)},!1))},[g]);const E=async t=>{try{Y(Z)({driver:"settyngs",cmd:"download",addres:+t})}catch(n){console.error(n)}};Te(()=>{const t=+(i==null?void 0:i.id);return t||console.error("Неверный id",t),y(),E(t).then(),()=>{g&&q({driver:"test",cmd:"stop"},!1)}},[]),P(()=>{if(m.value.socketStatus==="connected"){const n=setTimeout(()=>{j(!1)},2e3);return()=>clearTimeout(n)}else j(!0)},[m.value.socketStatus]),P(()=>{if(Array.isArray(m.value.settingsDriver)){const[t,n,h,k,T,M,he,me,ge,pe,it]=m.value.settingsDriver;ae(n);const fe=ke(h,k),be=Array(16).fill(!1).map((at,_e)=>fe.includes(_e));w(M),C(T),A(me),S(he),G(Ke(ge)),D(Je(pe)),O(be),ne(m.value.settingsDriver)}},[m.value.settingsDriver]);const le=t=>{O(n=>n.map((h,k)=>k===t?!h:h))};x(t=>{const n=Number(t.target.value);te(n),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{q({driver:"level",mode:"table",brightness:n,addres:Number(i==null?void 0:i.id)},!1),y()},500)},[]),x(t=>{const n=Number(t.target.value);se(n),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{q({driver:"level",mode:"table",brightness:n,addres:255},!1),y()},500)},[]);const re=()=>{const t=o.findIndex(n=>n===_);t<o.length-1&&D(o[t+1])},ce=()=>{const t=o.findIndex(n=>n===_);t>0&&D(o[t-1])},oe=()=>{const t=c.findIndex(n=>n===N);t<c.length-1&&G(c[t+1])},de=()=>{const t=c.findIndex(n=>n===N);t>0&&G(c[t-1])};P(()=>{R&&!F&&setTimeout(()=>{const t=+(i==null?void 0:i.id);Z({driver:"settyngs",cmd:"download",addres:+t}),z(!1)},0)},[R,F]);const ue=x(()=>{const t=L.map((T,M)=>T?M:-1).filter(T=>T!==-1),{g07:n,g815:h}=Ce(t);y(),Y(we)({driver:"settyngs",cmd:"save",dr_settyngs:[Number(i==null?void 0:i.id),n,h,d,p,f,b,...v!==7?[Xe(N),Qe(_)]:[]]}),z(!0)},[L,d,p,f,b,ee,v,_,N]),ve=()=>{E(+i.id)};return e("div",{className:s.devices,children:[ie&&e("div",{className:s.backdrop}),e("div",{id:"line",className:s.line}),e("div",{id:"drivers-list",className:s.content,children:e("div",{className:s.settingsAndGroupWrapper,children:[e("div",{className:s.buttonTabs,children:[e("div",{className:J(I==="settings"?s.buttonTabItemActiveSettings:s.buttonTabItemSettings),onClick:()=>U("settings"),children:"Настройки"}),e("div",{className:J(I==="group"?s.buttonTabItemActiveGroup:s.buttonTabItemGroup),onClick:()=>U("group"),children:"Группы"})]}),e("div",{className:s.contentBody,style:I=="settings"?{padding:" 0 12px 12px 20px"}:{padding:" 0 12px 12px 12px"},children:[I==="settings"&&e(K,{children:[e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Яркость максимальная"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:a?28:32,height:a?28:32,onClick:()=>{p>1&&w(t=>t-1)}}),e("div",{className:s.value,children:`${p??0}%`}),e(r,{direction:"left",double:!1,width:a?28:32,height:a?28:32,onClick:()=>{p<100&&w(t=>t+1)}})]})]}),e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Яркость минимальная"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:a?28:32,height:a?28:32,onClick:()=>{d>1&&C(t=>t-1)}}),e("div",{className:s.value,children:`${d??0}%`}),e(r,{direction:"left",double:!1,width:a?28:32,height:a?28:32,onClick:()=>{d<100&&C(t=>t+1)}})]})]}),e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Яркость при запуске"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:a?28:32,height:a?28:32,onClick:()=>{b>1&&A(t=>t-1)}}),e("div",{className:s.value,children:`${b??0}%`}),e(r,{direction:"left",double:!1,width:a?28:32,height:a?28:32,onClick:()=>{b<100&&A(t=>t+1)}})]})]}),e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Яркость при аварии"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:a?28:32,height:a?28:32,onClick:()=>{f>1&&S(t=>t-1)}}),e("div",{className:s.value,children:`${f??0}%`}),e(r,{direction:"left",double:!1,width:a?28:32,height:a?28:32,onClick:()=>{f<100&&S(t=>t+1)}})]})]}),!!v&&v!==7&&e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Плавное вкл/выкл"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:a?28:32,height:a?28:32,onClick:de}),e("div",{className:s.value,children:N??0}),e(r,{direction:"left",double:!1,width:a?28:32,height:a?28:32,onClick:oe})]})]}),!!v&&v!==7&&e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Шаг димирования"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:a?28:32,height:a?28:32,onClick:ce}),e("div",{className:s.value,children:_??0}),e(r,{direction:"left",double:!1,width:a?28:32,height:a?28:32,onClick:re})]})]})]}),I==="group"&&e("div",{className:s.groupFlex,children:L.map((t,n)=>e("div",{className:s.groupItem,onClick:()=>le(n),children:[n,e("input",{type:"checkbox",checked:t,readOnly:!0})]},n))})]})]})}),e("div",{className:s.wrapperBtn,children:F||R?e("div",{className:s.loadingText,children:e(xe,{})}):e(K,{children:[e("div",{onClick:()=>{u("/service")},children:e(ye,{height:V?50:56,width:V?50:56})}),e("div",{style:{display:"flex",gap:"20px"},children:[e(X,{text:"Обновить",onClick:()=>{ve()}}),e(X,{text:"Сохранить",onClick:()=>{ue()}})]})]})})]})}export{ct as D};
