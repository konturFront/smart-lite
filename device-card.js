import{u as be,a as _e,d as l,A as H,q as x,_ as Ne,y as $,b as e,c as J,k as K}from"./vendor.js";import{s as Te,u as Ie,a as y,b as q,c as m,p as qe,A as r,L as ke,S as xe,B as Q,w as X,d as ye,g as Ce,e as we}from"./index.js";const Se="_devices_1qeq9_2",Ae="_wrapperBtn_1qeq9_10",De="_content_1qeq9_29",Ge="_loadingText_1qeq9_39",We="_settingsAndGroupWrapper_1qeq9_59",Be="_buttonTabs_1qeq9_59",Le="_buttonTabItemSettings_1qeq9_62",Fe="_buttonTabItemGroup_1qeq9_63",Re="_buttonTabItemActiveSettings_1qeq9_78",Me="_buttonTabItemActiveGroup_1qeq9_79",Pe="_contentBody_1qeq9_93",$e="_element_1qeq9_108",Oe="_valueWrapper_1qeq9_115",Ue="_valueName_1qeq9_128",Ve="_value_1qeq9_115",je="_backdrop_1qeq9_150",ze="_line_1qeq9_160",Ee="_groupFlex_1qeq9_185",He="_groupItem_1qeq9_197",s={devices:Se,wrapperBtn:Ae,content:De,loadingText:Ge,settingsAndGroupWrapper:We,buttonTabs:Be,buttonTabItemSettings:Le,buttonTabItemGroup:Fe,buttonTabItemActiveSettings:Re,buttonTabItemActiveGroup:Me,contentBody:Pe,element:$e,valueWrapper:Oe,valueName:Ue,value:Ve,backdrop:je,line:ze,groupFlex:Ee,groupItem:He},c=[0,.7,1,1.4,2,2.8,4,5.7,8,11.3,16,22.6,32,45.3,64,90.5],o=[358,253,179,127,89.4,63.3,44.7,31.6,22.4,15.8,11.2,7.9,5.6,4,2.8],Je=a=>o[a-1]??o[0],Ke=a=>c[a]??c[0],Qe=a=>{const u=o.findIndex(d=>d===a);return u===-1?1:u+1},Xe=a=>c.findIndex(u=>u===a);function ct(){const{params:a}=be(),{route:u}=_e(),[d,C]=l(1),[g,O]=l(!1),[p,w]=l(1),[f,S]=l(1),[b,A]=l(1),[_,D]=l(2.8),[N,G]=l(0),[Y,Z]=l(0),[Ye,ee]=l(0),[W,U]=l(Array(16).fill(!1)),[Ze,te]=l(null),B=H(null),L=H(null),F=Te.value.isLoadingUI,[se,et]=l(!1),[T,V]=l("settings"),{isMobile340:i,isMobile400:j}=Ie(),[tt,z]=l(!1),[R,E]=l(!1),[v,ne]=l(void 0),[st,nt]=l({generalRange:0,r:0,g:0,b:0,w:0,light:0});x(()=>{g?(q({driver:"test",cmd:"stop"},!1),O(!g)):(O(!g),q({driver:"test",cmd:"start",addres:+(a==null?void 0:a.id)},!1))},[g]);const M=async t=>{try{X(ye)({driver:"settyngs",cmd:"download",addres:+t})}catch(n){console.error(n)}};Ne(()=>{const t=+(a==null?void 0:a.id);return t||console.error("Неверный id",t),y(),M(t).then(),()=>{g&&q({driver:"test",cmd:"stop"},!1)}},[]),$(()=>{if(m.value.socketStatus==="connected"){const n=setTimeout(()=>{z(!1)},2e3);return()=>clearTimeout(n)}else z(!0)},[m.value.socketStatus]),$(()=>{if(Array.isArray(m.value.settingsDriver)){const[t,n,h,k,I,P,ue,ve,he,me,it]=m.value.settingsDriver;ne(n);const ge=qe(h,k),pe=Array(16).fill(!1).map((at,fe)=>ge.includes(fe));w(P),C(I),A(ve),S(ue),G(Ke(he)),D(Je(me)),U(pe),te(m.value.settingsDriver)}},[m.value.settingsDriver]);const ie=t=>{U(n=>n.map((h,k)=>k===t?!h:h))};x(t=>{const n=Number(t.target.value);Z(n),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{q({driver:"level",mode:"table",brightness:n,addres:Number(a==null?void 0:a.id)},!1),y()},500)},[]),x(t=>{const n=Number(t.target.value);ee(n),L.current&&clearTimeout(L.current),L.current=setTimeout(()=>{q({driver:"level",mode:"table",brightness:n,addres:255},!1),y()},500)},[]);const ae=()=>{const t=o.findIndex(n=>n===_);t<o.length-1&&D(o[t+1])},le=()=>{const t=o.findIndex(n=>n===_);t>0&&D(o[t-1])},re=()=>{const t=c.findIndex(n=>n===N);t<c.length-1&&G(c[t+1])},ce=()=>{const t=c.findIndex(n=>n===N);t>0&&G(c[t-1])};$(()=>{R&&!F&&setTimeout(()=>{M(+a.id).then(),E(!1)},0)},[R,F]);const oe=x(()=>{const t=W.map((I,P)=>I?P:-1).filter(I=>I!==-1),{g07:n,g815:h}=Ce(t);y(),X(we)({driver:"settyngs",cmd:"save",dr_settyngs:[Number(a==null?void 0:a.id),n,h,d,p,f,b,...v!==7?[Xe(N),Qe(_)]:[]]}),E(!0)},[W,d,p,f,b,Y,v,_,N]),de=()=>{M(+a.id)};return e("div",{className:s.devices,children:[se&&e("div",{className:s.backdrop}),e("div",{id:"line",className:s.line}),e("div",{id:"drivers-list",className:s.content,children:e("div",{className:s.settingsAndGroupWrapper,children:[e("div",{className:s.buttonTabs,children:[e("div",{className:J(T==="settings"?s.buttonTabItemActiveSettings:s.buttonTabItemSettings),onClick:()=>V("settings"),children:"Настройки"}),e("div",{className:J(T==="group"?s.buttonTabItemActiveGroup:s.buttonTabItemGroup),onClick:()=>V("group"),children:"Группы"})]}),e("div",{className:s.contentBody,style:T=="settings"?{padding:" 0 12px 12px 20px"}:{padding:" 0 12px 12px 12px"},children:[T==="settings"&&e(K,{children:[e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Яркость максимальная"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:i?28:32,height:i?28:32,onClick:()=>{p>1&&w(t=>t-1)}}),e("div",{className:s.value,children:`${p??0}%`}),e(r,{direction:"left",double:!1,width:i?28:32,height:i?28:32,onClick:()=>{p<100&&w(t=>t+1)}})]})]}),e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Яркость минимальная"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:i?28:32,height:i?28:32,onClick:()=>{d>1&&C(t=>t-1)}}),e("div",{className:s.value,children:`${d??0}%`}),e(r,{direction:"left",double:!1,width:i?28:32,height:i?28:32,onClick:()=>{d<100&&C(t=>t+1)}})]})]}),e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Яркость при запуске"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:i?28:32,height:i?28:32,onClick:()=>{b>1&&A(t=>t-1)}}),e("div",{className:s.value,children:`${b??0}%`}),e(r,{direction:"left",double:!1,width:i?28:32,height:i?28:32,onClick:()=>{b<100&&A(t=>t+1)}})]})]}),e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Яркость при аварии"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:i?28:32,height:i?28:32,onClick:()=>{f>1&&S(t=>t-1)}}),e("div",{className:s.value,children:`${f??0}%`}),e(r,{direction:"left",double:!1,width:i?28:32,height:i?28:32,onClick:()=>{f<100&&S(t=>t+1)}})]})]}),!!v&&v!==7&&e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Плавное вкл/выкл"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:i?28:32,height:i?28:32,onClick:ce}),e("div",{className:s.value,children:N??0}),e(r,{direction:"left",double:!1,width:i?28:32,height:i?28:32,onClick:re})]})]}),!!v&&v!==7&&e("div",{className:s.element,children:[e("div",{className:s.valueName,children:"Шаг димирования"}),e("div",{className:s.valueWrapper,children:[e(r,{direction:"right",double:!1,width:i?28:32,height:i?28:32,onClick:le}),e("div",{className:s.value,children:_??0}),e(r,{direction:"left",double:!1,width:i?28:32,height:i?28:32,onClick:ae})]})]})]}),T==="group"&&e("div",{className:s.groupFlex,children:W.map((t,n)=>e("div",{className:s.groupItem,onClick:()=>ie(n),children:[n,e("input",{type:"checkbox",checked:t,readOnly:!0})]},n))})]})]})}),e("div",{className:s.wrapperBtn,children:F||R?e("div",{className:s.loadingText,children:e(ke,{})}):e(K,{children:[e("div",{onClick:()=>{u("/service")},children:e(xe,{height:j?50:56,width:j?50:56})}),e("div",{style:{display:"flex",gap:"20px"},children:[e(Q,{text:"Обновить",onClick:()=>{de()}}),e(Q,{text:"Сохранить",onClick:()=>{oe()}})]})]})})]})}export{ct as D};
